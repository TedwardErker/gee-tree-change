/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var grass = /* color: #eaed21 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[-87.89279595081712, 43.043241601696934],
             [-87.89379373257066, 43.043123985841774],
             [-87.89386883442307, 43.043594447909506],
             [-87.89364352886582, 43.04419036134945],
             [-87.89571133639971, 43.03332252812635],
             [-87.89600101497332, 43.03234223065552],
             [-87.89512125041644, 43.032553976235036],
             [-87.92110807483607, 43.02939841628083],
             [-87.92113355582171, 43.029448414228774],
             [-87.92115233128482, 43.02937194676246],
             [-87.92108661716395, 43.029283714952165],
             [-87.92101285641604, 43.02927587211845],
             [-87.92098066990786, 43.029448414228774],
             [-87.92094311898165, 43.0293895931093],
             [-87.94337807558767, 43.02558209237983],
             [-87.94337807558767, 43.02563405426129],
             [-87.94336198233358, 43.02571836967346],
             [-87.9424822177767, 43.02589876505015],
             [-87.94245673679106, 43.02583797971071],
             [-87.94241248034231, 43.0259173928034],
             [-87.9429314877867, 43.02605366935268],
             [-87.94305218719236, 43.026051708541175],
             [-87.94316886328451, 43.02600268823299],
             [-87.94373078607313, 43.02508207957434],
             [-87.94368384741537, 43.02490364264598],
             [-87.94356717132322, 43.025282085185246],
             [-87.95448012286991, 43.119553741229396],
             [-87.95448280507892, 43.11966142135971],
             [-87.95420117313236, 43.11934425388749],
             [-87.95395172769398, 43.11935795868879],
             [-87.95597494046717, 43.11651324527231],
             [-87.95603663127451, 43.11640555960172],
             [-87.95585692327052, 43.116742321432156],
             [-87.95581400792628, 43.116826511600166],
             [-87.95586765210658, 43.11685000651011],
             [-87.95589715640574, 43.11679126921836],
             [-87.95602322022944, 43.11648387647185],
             [-87.95608222882777, 43.116478002710075],
             [-87.95608222882777, 43.116411433370445],
             [-87.95591324965983, 43.11675211099253],
             [-87.95605004231959, 43.11651716111131],
             [-87.95779616038828, 43.11640555960172],
             [-87.95778811376124, 43.11638206452112],
             [-87.95591593186884, 43.11579664251715],
             [-87.95528829495936, 43.115798600459605],
             [-87.95430660645991, 43.11588279192602],
             [-87.95429587762385, 43.11593957215193],
             [-87.8896483960607, 43.08838604679692],
             [-87.88563685577057, 43.087840733682064],
             [-87.88564490239762, 43.08792300476935],
             [-87.88559125821732, 43.08781918647426],
             [-87.88567977111481, 43.08781722763681]]),
        {
          "class_2013": 0,
          "system:index": "0"
        }),
    impervious = /* color: #ff1429 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[-87.91399301411661, 43.02885974217624],
             [-87.91393936993632, 43.02917737829372],
             [-87.90637554051432, 43.02771859145308],
             [-87.9060107600883, 43.02789113794099],
             [-87.89947689892801, 43.02629898602833],
             [-87.89967001797709, 43.02716173356992],
             [-87.8993481528953, 43.025812704797914],
             [-87.90003479840311, 43.02856563319442],
             [-87.98084093267215, 43.11011189521767],
             [-87.98084227377666, 43.11016868079798],
             [-87.98080874616397, 43.11021861290267],
             [-87.98072023326648, 43.11024602658986],
             [-87.98083422714961, 43.11003944457319],
             [-87.9808489792992, 43.109986575129845],
             [-87.98080874616397, 43.11003259112941],
             [-87.98093480998767, 43.110098188345546],
             [-87.9116130630606, 43.03990928216491],
             [-87.91050262852843, 43.0401876539096],
             [-87.9106957475775, 43.04019941606817],
             [-87.91021294995483, 43.04026606825755],
             [-87.91248746319945, 43.040434658766365],
             [-87.90955849095519, 43.03914081276485],
             [-87.90988035603698, 43.03974853170894],
             [-87.9102612297171, 43.03975245245679],
             [-87.91036851807769, 43.039968093202106],
             [-87.91294343873199, 43.04116782605629],
             [-87.9127127687567, 43.041058047554515],
             [-87.91255183621581, 43.04097179287963],
             [-87.91221387787994, 43.04072871087074],
             [-87.91224606438811, 43.04062285227551],
             [-87.91113026543792, 43.040654217804246],
             [-87.91196175023254, 43.04195195249933],
             [-87.91205830975707, 43.04192842885186],
             [-87.91229970856841, 43.042300885544414],
             [-87.9122621576422, 43.042222473797054],
             [-87.91734762593444, 43.04062285227551],
             [-87.91717060013946, 43.04071694881361],
             [-87.91747100754912, 43.040689504004916],
             [-87.91783042355712, 43.040779679758856]]),
        {
          "class_2013": 1,
          "system:index": "0"
        }),
    soil = /* color: #c2a042 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[-87.90205207851092, 43.03016199294367],
             [-87.91629971386942, 43.02947932715305],
             [-87.91575254323038, 43.028683276956244],
             [-87.91520537259134, 43.02801270449353],
             [-87.93880051728034, 43.025756308327615],
             [-87.9389721786573, 43.02763866760804],
             [-87.94400168918364, 43.025175219523256],
             [-87.94392524622671, 43.02517325868367],
             [-87.96409291611147, 43.120457192858545],
             [-87.95338553772402, 43.116008924643864],
             [-87.97398042320805, 43.11811615926971],
             [-87.97408771156864, 43.1180535074529],
             [-87.97394823669987, 43.1179830240823],
             [-87.97417354225712, 43.11822971552418],
             [-87.97394104273218, 43.11823108155278],
             [-87.97408588201898, 43.11815472478592],
             [-87.97385252983469, 43.11816059838672],
             [-87.97390349180597, 43.11804116839229],
             [-87.97736010130536, 43.10980638563227],
             [-87.97750494059217, 43.10972414394309],
             [-87.97763368662488, 43.10972806021651],
             [-87.9774566608299, 43.10959490677964],
             [-87.97727427061689, 43.10959490677964],
             [-87.97748884733808, 43.10985338083363],
             [-87.91875578964573, 43.13838362059332],
             [-87.91871287430149, 43.13852454024567],
             [-87.91862167919498, 43.138411021662264],
             [-87.91857339943272, 43.13851671138461],
             [-87.89494749129905, 43.10917040493091],
             [-87.89508696616782, 43.109021585008925],
             [-87.88982005743765, 43.08755158409602],
             [-88.02826400293847, 42.85926848252819],
             [-88.02154775156517, 42.85960665607482],
             [-88.02139754786035, 42.85568215606835],
             [-88.02508826746484, 42.85492711343062],
             [-88.01925178064843, 42.85234731476479],
             [-88.01341529383203, 42.84699860838057],
             [-88.01478858484765, 42.84813131427157],
             [-88.00534720911523, 42.84781667582975],
             [-88.00723548426171, 42.84832009656738],
             [-88.006205516, 42.85303946644808],
             [-88.01968093409081, 42.86197381904089],
             [-88.02199836267968, 42.86304333798966],
             [-88.04122443689843, 42.867195412429425],
             [-87.97728057398339, 42.84970448244035],
             [-87.97547812952538, 42.84951570437566],
             [-87.97573562159081, 42.85178100307239],
             [-87.97307487024804, 42.849138146515315],
             [-87.97264571680566, 42.85228439149985],
             [-88.03676124109765, 42.84838302387108],
             [-88.03847785486718, 42.8448589961382],
             [-88.03993697657128, 42.84621199484698],
             [-88.04821963800927, 42.84646371226755],
             [-88.05126662745019, 42.84680982204602],
             [-88.05221076502343, 42.84489046156101],
             [-88.01122661127587, 42.84256197698516],
             [-88.01084037317773, 42.84164943882382],
             [-87.975048976083, 42.854046218685525],
             [-87.99036975397607, 42.85766409907011],
             [-88.02347894205589, 42.86189517721055],
             [-88.03283448709982, 42.861564880428915],
             [-87.97158295206253, 42.85210118501347],
             [-87.97166878275101, 42.850598868570025],
             [-87.96443754724686, 42.853131548463345],
             [-87.94696026116176, 42.85306233137319],
             [-87.94709973603054, 42.85248816085146],
             [-87.94227175980373, 42.84824857219881],
             [-87.94951908856197, 42.852696593233375],
             [-87.9483174589233, 42.853176378307126],
             [-87.94969074993892, 42.85322357008025],
             [-87.94845693379207, 42.85137519867984],
             [-87.94631116658016, 42.852012303154716],
             [-87.94572108059688, 42.851933648636866],
             [-87.94528119831844, 42.85161116406643],
             [-87.94606440335079, 42.85123361901514],
             [-87.94399373799129, 42.85242917042699],
             [-87.94406883984371, 42.85331008823735],
             [-87.94358604222103, 42.85186285948517],
             [-87.94390790730282, 42.851626895060164],
             [-87.94465892582699, 42.852177477316154]]),
        {
          "class_2013": 2,
          "system:index": "0"
        }),
    tree = /* color: #20c82d */ee.Feature(
        ee.Geometry.MultiPoint(
            [[-87.9214680826261, 43.028144541823664],
             [-87.92163706179404, 43.028207285621804],
             [-87.92140102740073, 43.02792689877678],
             [-87.92280114050651, 43.02723278876952],
             [-87.92295402642036, 43.027211220253726],
             [-87.92154586668754, 43.02729553349964],
             [-87.92144662495399, 43.02735435662587],
             [-87.92162633295798, 43.02767396129324],
             [-87.92179799433494, 43.02754455101492],
             [-87.92095578070426, 43.027917095017756],
             [-87.92131117339873, 43.02876707510712],
             [-87.92123741265083, 43.028782760903574],
             [-87.92111000772262, 43.028647470777294],
             [-87.92057222481513, 43.02869550860991],
             [-87.9203858112886, 43.02872393914618],
             [-87.92745745535636, 43.02848865155291],
             [-87.92784101124549, 43.0284435546612],
             [-87.92866981383109, 43.028314146005386],
             [-87.928653720577, 43.02814748294063],
             [-87.92905605192924, 43.02800434841795],
             [-87.92877441998267, 43.0280180736606],
             [-87.92925453539634, 43.028002387668735],
             [-87.92952812071586, 43.02802199515796],
             [-87.9279697572782, 43.02801415216301],
             [-87.92966431992559, 43.02653369251728],
             [-87.93021953719168, 43.02630035733203],
             [-87.93012565987615, 43.02600231446089],
             [-87.92989230769186, 43.02600231446089],
             [-87.92801476138143, 43.02607290369274],
             [-87.9281354607871, 43.02608859017767],
             [-87.94335125349753, 43.02542228480835],
             [-87.9433834400057, 43.02538895066123],
             [-87.94342501424543, 43.02540365690483],
             [-87.94338880442373, 43.02549679636583],
             [-87.9436717774748, 43.02511149220506],
             [-87.94362349771254, 43.025142865662275],
             [-87.94916292257982, 43.02248539703991],
             [-87.94914414711671, 43.023044258251545],
             [-87.94914951153474, 43.0232599577094],
             [-87.94642438717561, 43.02313249903044],
             [-87.94531931706148, 43.02223831993511],
             [-87.94564386435228, 43.02226577299588],
             [-87.94933726616578, 43.02198928089473],
             [-87.94917633362489, 43.02197555430406],
             [-87.9505469424315, 43.02186378052306],
             [-87.95109679527955, 43.021920647910754],
             [-87.95126309223848, 43.02191280413628],
             [-87.95121481247621, 43.022061835680056],
             [-87.95112898178773, 43.02208536694339],
             [-87.95085807867723, 43.02207360131285],
             [-87.95445407329035, 43.02209502680812],
             [-87.95389080939722, 43.02239308864928],
             [-87.95370841918421, 43.022498978691864],
             [-87.95266503987742, 43.02256368918353],
             [-87.95252020059061, 43.022561728260555],
             [-87.95267308650446, 43.02204796427986],
             [-87.95278573928309, 43.022000901715536],
             [-87.95975865854554, 43.12291232037794],
             [-87.95970233215623, 43.122933855236994],
             [-87.95973183645539, 43.12298671349522],
             [-87.95976670517258, 43.12277332246907],
             [-87.95974122418694, 43.122652922616695],
             [-87.95909212960534, 43.122683267317264],
             [-87.95903312100701, 43.12270088681392],
             [-87.95878903998666, 43.12259516975787],
             [-87.95872064365678, 43.122624535625114],
             [-87.95887352957062, 43.122628451073005],
             [-87.95871393813424, 43.122847715755356],
             [-87.95867504610352, 43.122901552945606],
             [-87.9587421013289, 43.12296713636785],
             [-87.95870186819367, 43.123013142607206],
             [-87.96113999618821, 43.122963220941635],
             [-87.96108232869439, 43.12299258663221],
             [-87.96120034589104, 43.12299160777607],
             [-87.96148868336014, 43.12286533520464],
             [-87.96143503917985, 43.12291427809272],
             [-87.96148734225564, 43.122951474661456],
             [-87.9615879250937, 43.122908404948205],
             [-87.96109708084397, 43.12250119888805],
             [-87.96115877165131, 43.12245812885782],
             [-87.96117084159188, 43.122556015246325],
             [-87.96121241583161, 43.122516860709716],
             [-87.96069340838723, 43.12229661597434],
             [-87.96062769426636, 43.12234751705031],
             [-87.96068267955117, 43.12240429127736],
             [-87.96071486605935, 43.12235926344642],
             [-87.96039434208207, 43.12241310106649],
             [-87.96026693715386, 43.122417995393235],
             [-87.9602199984961, 43.12244834021035],
             [-87.96034338011079, 43.12252664934621],
             [-87.96037824882798, 43.12247183296161],
             [-87.95156163559389, 43.11999515187985],
             [-87.95404292280048, 43.11935991651728],
             [-87.95400268966526, 43.11941669351673],
             [-87.95635766918033, 43.11969666208847],
             [-87.95630402500004, 43.119733860613465],
             [-87.95657761031956, 43.119508711300526],
             [-87.95652664834827, 43.11958702419899],
             [-87.95371569330067, 43.11879214362504],
             [-87.95378006631702, 43.11875102883172],
             [-87.95376665527195, 43.11866292561015],
             [-87.97878703650129, 43.11049956119315],
             [-87.98075041350019, 43.11010793754722],
             [-87.98078260000837, 43.10996695242125],
             [-87.98079131180538, 43.11008154428243],
             [-87.9807966762234, 43.11013343458191],
             [-87.9807591252972, 43.110189241081315],
             [-87.98616751274152, 43.11051223155514],
             [-87.98618092378659, 43.110271383359425],
             [-87.98614873727841, 43.11031250385017],
             [-87.98606827100797, 43.110206765389556],
             [-87.98615678390546, 43.11073153965693],
             [-87.9861648305325, 43.1108686068215],
             [-87.98607631763501, 43.11087252302168],
             [-87.9861836059956, 43.1109997993915],
             [-87.98610313972516, 43.11095476316781],
             [-87.98608168205304, 43.110500482884675],
             [-87.98615678390546, 43.1104593625202],
             [-87.9860387667088, 43.11025963464269],
             [-87.9863794072537, 43.11061013705482],
             [-87.98632039865537, 43.11065517353209],
             [-87.98644914468808, 43.11065517353209],
             [-87.98638477167172, 43.11039278663345],
             [-87.9864518268971, 43.11043978138455],
             [-87.98638745388074, 43.110255718403295],
             [-87.98633649190946, 43.110302713259635],
             [-87.9864518268971, 43.11031837820375],
             [-87.98585101207776, 43.11012452423833],
             [-87.98578932127042, 43.110185226051115],
             [-87.985714219418, 43.11008927799685],
             [-87.98741742214246, 43.110379079824256],
             [-87.98745497306867, 43.11041040966934],
             [-87.98744156202359, 43.110641466781644],
             [-87.98737718900723, 43.11068650323586],
             [-87.98729404052777, 43.11065125731799],
             [-87.98743619760556, 43.11090972691101],
             [-87.98747374853177, 43.11108399745991],
             [-87.98748179515881, 43.11099784129551],
             [-87.98740132888837, 43.11109378792546],
             [-87.98735573133511, 43.11093714028865],
             [-87.98712506135983, 43.11101154796613],
             [-87.98707409938855, 43.11109182983247],
             [-87.98696412881894, 43.11109770411125],
             [-87.98694803556485, 43.111007631774854],
             [-87.98709823926968, 43.11065908974594],
             [-87.98710628589673, 43.11073153965693],
             [-87.89669092715873, 43.11008289812036]]),
        {
          "class_2013": 3,
          "system:index": "0"
        }),
    water = /* color: #0c00c2 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[-87.89148990081125, 43.03252190097355],
             [-87.88936243694808, 43.01019918456226],
             [-87.87837610882308, 43.0005958218002],
             [-87.88035021465804, 43.00982261038359],
             [-87.88318262737776, 43.00649610486651],
             [-87.88747416180159, 43.019989302811986],
             [-87.89451227825667, 43.01506306019102],
             [-87.89262679603259, 43.03433025760413],
             [-87.89368895080248, 43.033365660855424],
             [-87.89704707648913, 43.03388325123975],
             [-87.89582398917834, 43.03529483919145],
             [-87.89584008243243, 43.03014630749968],
             [-87.94328822158568, 43.02575562528383],
             [-87.943347230184, 43.02566052539154],
             [-87.94333784245245, 43.0255634645248],
             [-87.94331370257132, 43.025374244414124],
             [-87.94321177862875, 43.02592621647404],
             [-87.94327615164511, 43.025847783801765],
             [-87.94325201176397, 43.025801704560095],
             [-87.97190975784855, 43.11731342801241],
             [-87.97197413086491, 43.11712546990377],
             [-87.97194194435673, 43.117033448535906],
             [-87.97201704620915, 43.11704323804971],
             [-87.97174614309864, 43.116949258652596],
             [-87.9716844522913, 43.116882689825644],
             [-87.97160398602085, 43.1167554256902],
             [-87.97160935043888, 43.116618371709876],
             [-87.97108363747196, 43.11669668830766],
             [-87.97130894302921, 43.11687485819418],
             [-87.97144841789799, 43.117072606581694],
             [-87.96974521517353, 43.116865068653425],
             [-87.9718829357584, 43.11740740685021],
             [-87.9719017112215, 43.117473975106336],
             [-87.99081309875531, 43.108988801802624],
             [-87.99056633552594, 43.10892614064102],
             [-87.99058779319806, 43.10879298545962],
             [-87.99056633552594, 43.10993654404919],
             [-87.990577064362, 43.11049265043641],
             [-87.99045904716534, 43.112583878523985],
             [-87.99040540298505, 43.11453014458534],
             [-87.98818488717755, 43.11561723273441],
             [-87.98939456344327, 43.11562702247477],
             [-88.06905194162587, 43.122018564351976],
             [-88.06892319559316, 43.12259022275476],
             [-88.07091875910024, 43.121838451693826],
             [-88.07562871813039, 43.122864303656144],
             [-88.0757038199828, 43.12401543003362],
             [-88.07650848268727, 43.123960614983],
             [-88.07670160173635, 43.123044413294245],
             [-87.89958683149206, 43.13758027352161],
             [-87.90078846113073, 43.132131059644934],
             [-87.9001876463114, 43.126806646103155],
             [-87.89709774152624, 43.11947698939197],
             [-87.89512363569128, 43.14353000993705],
             [-87.89108959333288, 43.14891558780704],
             [-87.89648802904867, 43.087716126936826],
             [-87.89632173208975, 43.08767303242601],
             [-87.89613934187673, 43.08757117255262],
             [-87.89625199465536, 43.08743797092418],
             [-87.88480706616576, 43.04475120215015],
             [-87.88541860982116, 43.04459438481874],
             [-87.88627691670592, 43.043676995398],
             [-87.88433499737914, 43.045472556711594],
             [-87.88167424603637, 43.04577834575911],
             [-87.88212485715087, 43.04466495266748],
             [-87.88197465344604, 43.045997885673714],
             [-87.88017220898803, 43.04665650070328],
             [-87.87569828435119, 43.04273606892079],
             [-87.8793031732672, 43.04428074895328],
             [-87.87864871426757, 43.046476166338685],
             [-87.87909932538207, 43.045990044976016],
             [-87.8779513399237, 43.04684467512719],
             [-88.03538795008201, 42.85975608100555],
             [-87.96500617555802, 42.85571131436991]]),
        {
          "class_2013": 4,
          "system:index": "0"
        });
/***** End of imports. If edited, may not auto-convert in the playground. *****/


var milwaukeeExport = ee.Geometry.Polygon(
        [[[-88.35575750089527, 43.35209206347098],
          [-88.35575750089527, 42.80743795582355],
          [-87.76249578214527, 42.80743795582355],
          [-87.76249578214527, 43.35209206347098]]], null, false),
    wb = ee.Image("users/erker/milwaukee/milwaukee_water/mke_water_bodies_26916_input"),
    wl = ee.Image("users/erker/milwaukee/milwaukee_water/mke_water_lines_26916_input"),
    height = ee.Image("users/erker/milwaukee/milwaukee_height/mke_2015height");
var errors = ee.FeatureCollection("users/erker/milwaukee/milwaukee_shapefiles/Tree_Map_Errors_MKE_fromDan")

var pts = ee.FeatureCollection('users/erker/milwaukee/milwaukee_shapefiles/milwaukee_accuracy_training');

var classProperty = 'class_2013';

var pts = pts.remap(['G','I','S','T','W'], [0,1,2,3,4], classProperty);


var testpts = ee.FeatureCollection('users/erker/milwaukee/milwaukee_shapefiles/milwaukee_accuracy_testing').filter(ee.Filter.neq(classProperty, '')).remap(['G','I','S','T','W'], [0,1,2,3,4], classProperty);
// var testpts = testpts.randomColumn();
// testpts =  testpts.filter(ee.Filter.lt('random', 0.2));
// print(testpts.size());



var buf3000 = function(feature) {return feature.buffer(3000)};
var urbanregion = testpts.map(buf3000);
var naip = ee.ImageCollection('USDA/NAIP/DOQQ').filterBounds(urbanregion); 
var naip13c = naip.filterDate('2013-01-01', '2013-12-31');
var naip15c = naip.filterDate('2015-01-01', '2015-12-31');



var naip13 = naip13c.median().byte();
var naip15 = naip15c.median().byte();


var ndvi13 = naip13.normalizedDifference(['N', 'R']);
var gauss53 = ee.Kernel.gaussian({radius: 5, sigma: 3, units: 'pixels', normalize:true});
var naip13Gauss53 = naip13.convolve(gauss53);
var heightGauss53 = height.convolve(gauss53);

var gauss104 = ee.Kernel.gaussian({radius: 10, sigma: 4, units: 'pixels', normalize:true});
var naip13Gauss104 = naip13.convolve(gauss104);

var win10 = ee.Kernel.square({radius: 10});
var entro10 = naip13.select('N').entropy(win10);

var win5 = ee.Kernel.square({radius: 5});
var entro5 = naip13.select('N').entropy(win5);

var nir13glcm3 = naip13.select(['N']).glcmTexture({size: 3, average: false});
var contrast3 = nir13glcm3.select('N_contrast_-1_-1', 'N_contrast_0_-1', 'N_contrast_1_-1', 'N_contrast_-1_0');
var nir13glcm7 = naip13.select(['N']).glcmTexture({size: 7, average: false});
var contrast7 = nir13glcm7.select('N_contrast_-1_-1', 'N_contrast_0_-1', 'N_contrast_1_-1', 'N_contrast_-1_0');
var nir13glcm14 = naip13.select(['N']).glcmTexture({size: 14, average: false});
var contrast14 = nir13glcm14.select('N_contrast_-1_-1', 'N_contrast_0_-1', 'N_contrast_1_-1', 'N_contrast_-1_0');

// var image = ee.Image.cat([naip13, ndvi13, naip13Gauss53, entro10, entro5, contrast7, contrast14, wl, wb]);
// var image = naip13;
var image = ee.Image.cat([naip13, naip13Gauss53, naip15, entro5, contrast3, wl, wb, heightGauss53]);
print(image);

// var training = image.sampleRegions({
//   collection: trainingData,
//   properties: [classProperty],
//   scale: 1
// });


var trainingGrass = image.sampleRegions({collection: grass, properties: [classProperty], scale: 1})
var trainingImpervious = image.sampleRegions({collection: impervious, properties: [classProperty], scale: 1})
var trainingSoil = image.sampleRegions({collection: soil, properties: [classProperty], scale: 1})
var trainingTree = image.sampleRegions({collection: tree, properties: [classProperty], scale: 1})
var trainingWater = image.sampleRegions({collection: water, properties: [classProperty], scale: 1})
var trainingPts = image.sampleRegions({collection: pts, properties: [classProperty], scale: 1});

var training = trainingPts.merge(trainingGrass).merge(trainingTree).merge(trainingSoil).merge(trainingImpervious).merge(trainingWater);
print(training.size());


var trainedClassifier = ee.Classifier.smileRandomForest(100).train({
  features: training,
  classProperty: classProperty,
  inputProperties: image.bandNames()
});

print(trainedClassifier);

var testing = image.sampleRegions({collection: testpts, properties: [classProperty], scale: 1});

var testClassified = testing.classify(trainedClassifier);
var testAccuracy = testClassified.errorMatrix(classProperty, 'classification');
print('testing error matrix: ', testAccuracy);
print('testing overall accuracy: ', testAccuracy.accuracy());


var classified = image.classify(trainedClassifier);

Map.addLayer(height);
Map.addLayer(naip15);
Map.addLayer(naip13);
Map.addLayer(classified, {min: 0, max: 4, palette: ['yellow', 'red', 'brown','green','blue']});
Map.addLayer(errors);

// // Export.image.toDrive({
// //   image: classified,
// //   description: 'marathon-2010-5',
// //   scale: 1,
// // });


// // Export.image.toDrive({
// //   image: classified,
// //   description: 'milwaukee-2010-fullcounty',
// //   scale: 1,
// //   maxPixels: 12000000000,
// //   crs: 'EPSG:3070'
// // });


// // Export.image.toAsset({
// //   image: classified,
// //   description: 'milwaukeeClassified2010',
// //   assetId: 'milwaukeeClassified2010',
// //   scale: 1,
// //   region: marathonExport,
// //   pyramidingPolicy: {
// //     'classification': 'mode'
// //   }
// // });