/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var grass = /* color: #ebea4c */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-90.32759895681639, 44.95183067981798],
               [-90.32731598376532, 44.95183162891898],
               [-90.32731866597433, 44.95187338934743],
               [-90.3276016390254, 44.95186864384575]]],
             [[[-90.3330760276248, 44.95184491633134],
               [-90.33294728159208, 44.9518487127343],
               [-90.33293655275602, 44.95189047315033],
               [-90.33307066320677, 44.951886676750135]]],
             [[[-90.31275778888498, 44.955171520817295],
               [-90.31275242446695, 44.955053839022575],
               [-90.31269341586862, 44.95505004283161],
               [-90.31270950912271, 44.95516962272574]]],
             [[[-90.30721104304865, 44.95506064624272],
               [-90.30716008107737, 44.9550853214748],
               [-90.30730760257319, 44.95510430241534],
               [-90.30730492036417, 44.9550853214748]]],
             [[[-90.2957931975024, 44.955196186057094],
               [-90.29568859135082, 44.95519998223836],
               [-90.29569127355984, 44.95522845358996],
               [-90.29579856192044, 44.955222759320755]]],
             [[[-90.31889101099055, 44.94854728856143],
               [-90.31867375206035, 44.94857481405867],
               [-90.31869118641895, 44.94861183108584],
               [-90.31884139012378, 44.94861183108584],
               [-90.31886150669139, 44.948647898935505]]],
             [[[-90.31822179984134, 44.948419152452345],
               [-90.31797771882098, 44.948439084754774],
               [-90.31799381207507, 44.94846850861713],
               [-90.31822716425937, 44.94843718644053]]],
             [[[-90.3185919726912, 44.9485916654168],
               [-90.3185383285109, 44.94851122451059],
               [-90.31852055887617, 44.94851478384509],
               [-90.31855609814562, 44.94858905524165]]],
             [[[-90.31743637418002, 44.94853456990637],
               [-90.31742028092593, 44.94851226474746],
               [-90.31722749715298, 44.948555451323905],
               [-90.31724291985482, 44.94857775646602]]],
             [[[-90.17772148586307, 44.66856545103105],
               [-90.17763531989847, 44.66853302271354],
               [-90.17757262326275, 44.66858238051313],
               [-90.17767052389179, 44.66861647790569]]],
             [[[-90.15824054155938, 44.66967314275666],
               [-90.15686188612572, 44.66955964573502],
               [-90.15684981618516, 44.669580628394414],
               [-90.15822981272332, 44.66968935659871]]],
             [[[-90.16020739927592, 44.66884922926931],
               [-90.1601872827083, 44.66883301519222],
               [-90.16021142258944, 44.66880011013946],
               [-90.16023824467959, 44.668786280474016],
               [-90.16023489191832, 44.66875862113324],
               [-90.16025232627692, 44.66873525374886],
               [-90.16028183057608, 44.66873096177927],
               [-90.1602670784265, 44.66870664061228],
               [-90.1603220637113, 44.66867659680368],
               [-90.16036296739878, 44.66866276710877],
               [-90.16033547475638, 44.66864559920707],
               [-90.16020739927592, 44.668711886355055],
               [-90.16015777840914, 44.66884970615387]]],
             [[[-90.15892873970532, 44.66866413735862],
               [-90.15880234060549, 44.668614541185406],
               [-90.1587637838509, 44.668647923229756],
               [-90.15888180104756, 44.66869632715988]]],
             [[[-90.13511699521672, 44.66391370191776],
               [-90.13433647239339, 44.66389844031064],
               [-90.13434720122945, 44.663984286798375],
               [-90.1350955375446, 44.663990009893055]]],
             [[[-90.11988796773436, 44.66400355919166],
               [-90.11989064994337, 44.663957774429235],
               [-90.11908062282087, 44.66397112832199],
               [-90.11907257619383, 44.664016913073894]]],
             [[[-90.15896170458396, 44.66973694325697],
               [-90.1591320248564, 44.669742665783694],
               [-90.15913873037894, 44.66969593179895]]],
             [[[-90.15963412230256, 44.670025017506354],
               [-90.1596321106458, 44.66995634748296],
               [-90.15955298547986, 44.669953486230206],
               [-90.15943496828321, 44.67003074000463]]],
             [[[-90.1809807704316, 44.67088342151117],
               [-90.18110214048185, 44.670824766703156],
               [-90.18111353977784, 44.67072223996478],
               [-90.18104246123895, 44.670705072673094],
               [-90.18104246128202, 44.6707956777452],
               [-90.18095126613244, 44.67083096602753],
               [-90.18082922562226, 44.67086243932342]]],
             [[[-90.18508854210222, 44.67018870990065],
               [-90.18511804640139, 44.67018775615357],
               [-90.18511603474462, 44.67008141325635],
               [-90.18508518934095, 44.670084274502756]]],
             [[[-89.55586191907231, 44.92580294608634],
               [-89.5558592368633, 44.92575167137145],
               [-89.55575865402524, 44.925752620903616],
               [-89.55576535954778, 44.925808643274046]]],
             [[[-89.55579486384694, 44.92562903541189],
               [-89.55579754605596, 44.92556256797886],
               [-89.55567282333676, 44.925565416584696],
               [-89.55567416444127, 44.92563188401444]]]]),
        {
          "class_2010": 0,
          "system:index": "0"
        }),
    impervious = /* color: #ff0000 */ee.Feature(
        ee.Geometry.Polygon(
            [[[-90.18233100564288, 44.67047465600999],
              [-90.18217409641551, 44.670575275741754],
              [-90.18222975225257, 44.670597688644015],
              [-90.18238062650966, 44.670484670303935]]]),
        {
          "class_2010": 1,
          "system:index": "0"
        }),
    soil = /* color: #c49e60 */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-90.18684060435677, 44.6702555094778],
               [-90.18683859270001, 44.670170626024536],
               [-90.18677019637013, 44.67017205664556],
               [-90.18676550250436, 44.67025646322376]]],
             [[[-90.18678538567447, 44.6704307043181],
               [-90.18677633321904, 44.6703784868607],
               [-90.18672235376262, 44.67037729468077],
               [-90.186723359591, 44.67043165806116]]],
             [[[-90.18183120679058, 44.66952434200982],
               [-90.18175677549041, 44.66952052697771],
               [-90.18173263560928, 44.6695515241064],
               [-90.18172727119125, 44.66960541138303],
               [-90.1817453761021, 44.66965214544078],
               [-90.18182316016353, 44.669649761051]]]]),
        {
          "class_2010": 2,
          "system:index": "0"
        }),
    tree = /* color: #3fc439 */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-90.18256213790794, 44.6707525125722],
               [-90.18248971826453, 44.670794477019726],
               [-90.1826104176702, 44.6709012954763],
               [-90.18279817230125, 44.670834533964]]],
             [[[-90.1835465086164, 44.6707153167865],
               [-90.18326621777435, 44.67066190741145],
               [-90.18318843371291, 44.67077254106231],
               [-90.183384234971, 44.67086505352202]]],
             [[[-90.18076774007697, 44.67084884000883],
               [-90.18084820634742, 44.6708450250639],
               [-90.18093269593139, 44.67079352328262],
               [-90.18092867261787, 44.67067812097694],
               [-90.18077444559951, 44.67065427749671],
               [-90.18072616583724, 44.67070768687879]]],
             [[[-90.17888525320174, 44.6706329225794],
               [-90.17891945136668, 44.670649136152996],
               [-90.1789945532191, 44.670634353189],
               [-90.179020704757, 44.670578082517416],
               [-90.17894761456134, 44.67053277981841],
               [-90.17889262927653, 44.67053754852524],
               [-90.17885709000709, 44.670567114498795],
               [-90.17885239614131, 44.67060144915887],
               [-90.17888324154498, 44.670629107620236]]],
             [[[-90.1782985976232, 44.67030002009005],
               [-90.1782275190843, 44.67032577120567],
               [-90.17822215466627, 44.67036964345036],
               [-90.17823824792036, 44.67041733063521],
               [-90.178263728906, 44.67045261912673],
               [-90.17836565284857, 44.67040683945792],
               [-90.17839515714773, 44.670351522309836]]],
             [[[-89.55579084053342, 44.92573253454735],
               [-89.55578547611539, 44.92564422795721],
               [-89.55567684665029, 44.92564517749115],
               [-89.5556781877548, 44.92574677753306]]]]),
        {
          "class_2010": 3,
          "system:index": "0"
        }),
    water = /* color: #071cdc */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-90.19141096778202, 44.72775042989522],
               [-90.19048024125385, 44.72773709070237],
               [-90.19048292346287, 44.72783808737174],
               [-90.19118566222477, 44.727866671302735]]],
             [[[-90.18068170172155, 44.7268119886652],
               [-90.18040006977499, 44.72672814089871],
               [-90.18039202314795, 44.726926326332695]]],
             [[[-90.14627058985452, 44.73071951409461],
               [-90.14649857762079, 44.7306471050135],
               [-90.14709671023111, 44.73058803438016],
               [-90.14707525255899, 44.7304222551838]]],
             [[[-89.6327442106096, 44.92378063426519],
               [-89.63282467688005, 44.924000932867315],
               [-89.63554443682115, 44.9237844325241]]],
             [[[-89.56341166230322, 44.92523020039423],
               [-89.56347268260947, 44.92516278292655],
               [-89.56349883409621, 44.925095365442296],
               [-89.56342105003478, 44.9250811222951],
               [-89.56336874695899, 44.925154237079944],
               [-89.56321317883612, 44.92520646186932]]]]),
        {
          "class_2010": 4,
          "system:index": "0"
        });
/***** End of imports. If edited, may not auto-convert in the playground. *****/


var pts = ee.FeatureCollection('users/erker/UTC/marathon_shapefiles/marathon_combined_sub_1k');
var testpts = ee.FeatureCollection('users/erker/UTC/marathon_shapefiles/marathon_accuracy_randompoints_20200522').filter(ee.Filter.neq('class_2010', '')).remap(['G','I','S','T','W'], [0,1,2,3,4], 'class_2017');

var naip = ee.ImageCollection('USDA/NAIP/DOQQ').filterBounds(testpts);  // testpts has greater extent than pts
var naip05c = naip.filterDate('2005-01-01', '2005-12-31');
var naip08c = naip.filterDate('2008-01-01', '2008-12-31');
var naip10c = naip.filterDate('2010-01-01', '2010-12-31');
var pts = pts.remap([1,2,3,4,5], [0,1,2,3,4], 'class_2010');


Map.addLayer(naip05c);
Map.addLayer(naip08c);
Map.addLayer(naip10c);

// var pts = pts.merge(grass).merge(tree).merge(soil).merge(impervious).merge(water);

// var naip17 = naip17c.median().byte();
// var naip18 = naip18c.median().byte();



// var ndvi = naip17.normalizedDifference(['N', 'R']);
// var gauss53 = ee.Kernel.gaussian({radius: 5, sigma: 3, units: 'pixels', normalize:true});
// var naip17Gauss53 = naip17.convolve(gauss53);
// var naip18Gauss53 = naip18.convolve(gauss53);
// var gauss104 = ee.Kernel.gaussian({radius: 10, sigma: 4, units: 'pixels', normalize:true});
// var naip17Gauss104 = naip17.convolve(gauss104);
// var naip18Gauss104 = naip18.convolve(gauss104);
// var win10 = ee.Kernel.square({radius: 10});
// var entro10 = naip17.select('N').entropy(win10);
// var win5 = ee.Kernel.square({radius: 5});
// var entro5 = naip17.select('N').entropy(win5);
// var nir17glcm3 = naip17.select(['N']).glcmTexture({size: 3, average: false});
// var contrast3 = nir17glcm3.select('N_contrast_-1_-1', 'N_contrast_0_-1', 'N_contrast_1_-1', 'N_contrast_-1_0');
// var nir17glcm7 = naip17.select(['N']).glcmTexture({size: 7, average: false});
// var contrast7 = nir17glcm7.select('N_contrast_-1_-1', 'N_contrast_0_-1', 'N_contrast_1_-1', 'N_contrast_-1_0');

// var image = ee.Image.cat([naip17, naip18, ndvi, naip17Gauss53, naip17Gauss104, naip18Gauss104, entro10, entro5, contrast3, contrast7]);


// var classProperty = 'class_2017';

// var training = image.sampleRegions({
//   collection: pts,
//   properties: [classProperty],
//   scale: 1
// });
// print(training.size());


// var trainedClassifier = ee.Classifier.smileRandomForest(100).train({
//   features: training,
//   classProperty: classProperty,
//   inputProperties: image.bandNames()
// });

// // print(trainedClassifier);

// var testing = image.sampleRegions({collection: testpts, properties: [classProperty], scale: 1});
// var testClassified = testing.classify(trainedClassifier);
// var testAccuracy = testClassified.errorMatrix('class_2017', 'classification');
// print('Validation error matrix: ', testAccuracy);
// print('Validation overall accuracy: ', testAccuracy.accuracy());


// var classified = image.classify(trainedClassifier);




// // Map.centerObject(pts, 24);
// Map.addLayer(naip17);
// //Map.addLayer(naip18);
// Map.addLayer(classified, {min: 0, max: 4, palette: ['yellow', 'red', 'brown','green','blue']});



// Export.image.toDrive({
//   image: classified,
//   description: 'elderon',
//   scale: 1,
//   region: elderon
// });



// // // Export.image.toDrive({
// // //   image: classified,
// // //   description: 'active2017-4',
// // //   scale: 1,
// // //   maxPixels: 12000000000
// // //             //  region: 
// // // });


